{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs3/core-js-stable/object/define-property\");\n\nvar _Reflect$construct = require(\"@babel/runtime-corejs3/core-js-stable/reflect/construct\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.opFromJSON = opFromJSON;\nexports.RelationOp = exports.RemoveOp = exports.AddUniqueOp = exports.AddOp = exports.IncrementOp = exports.UnsetOp = exports.SetOp = exports.Op = void 0;\n\nvar _map = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/map\"));\n\nvar _splice = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/splice\"));\n\nvar _indexOf = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/index-of\"));\n\nvar _forEach = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/for-each\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/getPrototypeOf\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/defineProperty\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/createClass\"));\n\nvar _concat = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/concat\"));\n\nvar _isArray = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\"));\n\nvar _arrayContainsObject = _interopRequireDefault(require(\"./arrayContainsObject\"));\n\nvar _decode = _interopRequireDefault(require(\"./decode\"));\n\nvar _encode = _interopRequireDefault(require(\"./encode\"));\n\nvar _ParseObject = _interopRequireDefault(require(\"./ParseObject\"));\n\nvar _ParseRelation = _interopRequireDefault(require(\"./ParseRelation\"));\n\nvar _unique = _interopRequireDefault(require(\"./unique\"));\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function () {\n    var Super = (0, _getPrototypeOf2.default)(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2.default)(this).constructor;\n      result = _Reflect$construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return (0, _possibleConstructorReturn2.default)(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !_Reflect$construct) return false;\n  if (_Reflect$construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(_Reflect$construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction opFromJSON(json\n/*: { [key: string]: any }*/\n)\n/*: ?Op*/\n{\n  if (!json || !json.__op) {\n    return null;\n  }\n\n  switch (json.__op) {\n    case 'Delete':\n      return new UnsetOp();\n\n    case 'Increment':\n      return new IncrementOp(json.amount);\n\n    case 'Add':\n      return new AddOp((0, _decode.default)(json.objects));\n\n    case 'AddUnique':\n      return new AddUniqueOp((0, _decode.default)(json.objects));\n\n    case 'Remove':\n      return new RemoveOp((0, _decode.default)(json.objects));\n\n    case 'AddRelation':\n      {\n        var toAdd = (0, _decode.default)(json.objects);\n\n        if (!(0, _isArray.default)(toAdd)) {\n          return new RelationOp([], []);\n        }\n\n        return new RelationOp(toAdd, []);\n      }\n\n    case 'RemoveRelation':\n      {\n        var toRemove = (0, _decode.default)(json.objects);\n\n        if (!(0, _isArray.default)(toRemove)) {\n          return new RelationOp([], []);\n        }\n\n        return new RelationOp([], toRemove);\n      }\n\n    case 'Batch':\n      {\n        var _toAdd = [];\n        var _toRemove = [];\n\n        for (var i = 0; i < json.ops.length; i++) {\n          if (json.ops[i].__op === 'AddRelation') {\n            _toAdd = (0, _concat.default)(_toAdd).call(_toAdd, (0, _decode.default)(json.ops[i].objects));\n          } else if (json.ops[i].__op === 'RemoveRelation') {\n            _toRemove = (0, _concat.default)(_toRemove).call(_toRemove, (0, _decode.default)(json.ops[i].objects));\n          }\n        }\n\n        return new RelationOp(_toAdd, _toRemove);\n      }\n  }\n\n  return null;\n}\n\nvar Op = /*#__PURE__*/function () {\n  function Op() {\n    (0, _classCallCheck2.default)(this, Op);\n  }\n\n  (0, _createClass2.default)(Op, [{\n    key: \"applyTo\",\n    value: // Empty parent class\n    function ()\n    /*: mixed*/\n\n    /*: mixed*/\n    {}\n    /* eslint-disable-line no-unused-vars */\n\n  }, {\n    key: \"mergeWith\",\n    value: function ()\n    /*: Op*/\n\n    /*: ?Op*/\n    {}\n    /* eslint-disable-line no-unused-vars */\n\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: mixed*/\n    {}\n  }]);\n  return Op;\n}();\n\nexports.Op = Op;\n\nvar SetOp = /*#__PURE__*/function (_Op) {\n  (0, _inherits2.default)(SetOp, _Op);\n\n  var _super = _createSuper(SetOp);\n\n  function SetOp(value\n  /*: mixed*/\n  ) {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, SetOp);\n    _this = _super.call(this);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"_value\", void 0);\n    _this._value = value;\n    return _this;\n  }\n\n  (0, _createClass2.default)(SetOp, [{\n    key: \"applyTo\",\n    value: function ()\n    /*: mixed*/\n    {\n      return this._value;\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function ()\n    /*: SetOp*/\n    {\n      return new SetOp(this._value);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function (offline\n    /*:: ?: boolean*/\n    ) {\n      return (0, _encode.default)(this._value, false, true, undefined, offline);\n    }\n  }]);\n  return SetOp;\n}(Op);\n\nexports.SetOp = SetOp;\n\nvar UnsetOp = /*#__PURE__*/function (_Op2) {\n  (0, _inherits2.default)(UnsetOp, _Op2);\n\n  var _super2 = _createSuper(UnsetOp);\n\n  function UnsetOp() {\n    (0, _classCallCheck2.default)(this, UnsetOp);\n    return _super2.apply(this, arguments);\n  }\n\n  (0, _createClass2.default)(UnsetOp, [{\n    key: \"applyTo\",\n    value: function () {\n      return undefined;\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function ()\n    /*: UnsetOp*/\n    {\n      return new UnsetOp();\n    }\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: { __op: string }*/\n    {\n      return {\n        __op: 'Delete'\n      };\n    }\n  }]);\n  return UnsetOp;\n}(Op);\n\nexports.UnsetOp = UnsetOp;\n\nvar IncrementOp = /*#__PURE__*/function (_Op3) {\n  (0, _inherits2.default)(IncrementOp, _Op3);\n\n  var _super3 = _createSuper(IncrementOp);\n\n  function IncrementOp(amount\n  /*: number*/\n  ) {\n    var _this2;\n\n    (0, _classCallCheck2.default)(this, IncrementOp);\n    _this2 = _super3.call(this);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this2), \"_amount\", void 0);\n\n    if (typeof amount !== 'number') {\n      throw new TypeError('Increment Op must be initialized with a numeric amount.');\n    }\n\n    _this2._amount = amount;\n    return _this2;\n  }\n\n  (0, _createClass2.default)(IncrementOp, [{\n    key: \"applyTo\",\n    value: function (value\n    /*: ?mixed*/\n    )\n    /*: number*/\n    {\n      if (typeof value === 'undefined') {\n        return this._amount;\n      }\n\n      if (typeof value !== 'number') {\n        throw new TypeError('Cannot increment a non-numeric value.');\n      }\n\n      return this._amount + value;\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function (previous\n    /*: Op*/\n    )\n    /*: Op*/\n    {\n      if (!previous) {\n        return this;\n      }\n\n      if (previous instanceof SetOp) {\n        return new SetOp(this.applyTo(previous._value));\n      }\n\n      if (previous instanceof UnsetOp) {\n        return new SetOp(this._amount);\n      }\n\n      if (previous instanceof IncrementOp) {\n        return new IncrementOp(this.applyTo(previous._amount));\n      }\n\n      throw new Error('Cannot merge Increment Op with the previous Op');\n    }\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: { __op: string, amount: number }*/\n    {\n      return {\n        __op: 'Increment',\n        amount: this._amount\n      };\n    }\n  }]);\n  return IncrementOp;\n}(Op);\n\nexports.IncrementOp = IncrementOp;\n\nvar AddOp = /*#__PURE__*/function (_Op4) {\n  (0, _inherits2.default)(AddOp, _Op4);\n\n  var _super4 = _createSuper(AddOp);\n\n  function AddOp(value\n  /*: mixed | Array<mixed>*/\n  ) {\n    var _this3;\n\n    (0, _classCallCheck2.default)(this, AddOp);\n    _this3 = _super4.call(this);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this3), \"_value\", void 0);\n    _this3._value = (0, _isArray.default)(value) ? value : [value];\n    return _this3;\n  }\n\n  (0, _createClass2.default)(AddOp, [{\n    key: \"applyTo\",\n    value: function (value\n    /*: mixed*/\n    )\n    /*: Array<mixed>*/\n    {\n      if (value == null) {\n        return this._value;\n      }\n\n      if ((0, _isArray.default)(value)) {\n        return (0, _concat.default)(value).call(value, this._value);\n      }\n\n      throw new Error('Cannot add elements to a non-array value');\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function (previous\n    /*: Op*/\n    )\n    /*: Op*/\n    {\n      if (!previous) {\n        return this;\n      }\n\n      if (previous instanceof SetOp) {\n        return new SetOp(this.applyTo(previous._value));\n      }\n\n      if (previous instanceof UnsetOp) {\n        return new SetOp(this._value);\n      }\n\n      if (previous instanceof AddOp) {\n        return new AddOp(this.applyTo(previous._value));\n      }\n\n      throw new Error('Cannot merge Add Op with the previous Op');\n    }\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: { __op: string, objects: mixed }*/\n    {\n      return {\n        __op: 'Add',\n        objects: (0, _encode.default)(this._value, false, true)\n      };\n    }\n  }]);\n  return AddOp;\n}(Op);\n\nexports.AddOp = AddOp;\n\nvar AddUniqueOp = /*#__PURE__*/function (_Op5) {\n  (0, _inherits2.default)(AddUniqueOp, _Op5);\n\n  var _super5 = _createSuper(AddUniqueOp);\n\n  function AddUniqueOp(value\n  /*: mixed | Array<mixed>*/\n  ) {\n    var _this4;\n\n    (0, _classCallCheck2.default)(this, AddUniqueOp);\n    _this4 = _super5.call(this);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this4), \"_value\", void 0);\n    _this4._value = (0, _unique.default)((0, _isArray.default)(value) ? value : [value]);\n    return _this4;\n  }\n\n  (0, _createClass2.default)(AddUniqueOp, [{\n    key: \"applyTo\",\n    value: function (value\n    /*: mixed | Array<mixed>*/\n    )\n    /*: Array<mixed>*/\n    {\n      if (value == null) {\n        return this._value || [];\n      }\n\n      if ((0, _isArray.default)(value)) {\n        var _context;\n\n        var toAdd = [];\n        (0, _forEach.default)(_context = this._value).call(_context, function (v) {\n          if (v instanceof _ParseObject.default) {\n            if (!(0, _arrayContainsObject.default)(value, v)) {\n              toAdd.push(v);\n            }\n          } else {\n            if ((0, _indexOf.default)(value).call(value, v) < 0) {\n              toAdd.push(v);\n            }\n          }\n        });\n        return (0, _concat.default)(value).call(value, toAdd);\n      }\n\n      throw new Error('Cannot add elements to a non-array value');\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function (previous\n    /*: Op*/\n    )\n    /*: Op*/\n    {\n      if (!previous) {\n        return this;\n      }\n\n      if (previous instanceof SetOp) {\n        return new SetOp(this.applyTo(previous._value));\n      }\n\n      if (previous instanceof UnsetOp) {\n        return new SetOp(this._value);\n      }\n\n      if (previous instanceof AddUniqueOp) {\n        return new AddUniqueOp(this.applyTo(previous._value));\n      }\n\n      throw new Error('Cannot merge AddUnique Op with the previous Op');\n    }\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: { __op: string, objects: mixed }*/\n    {\n      return {\n        __op: 'AddUnique',\n        objects: (0, _encode.default)(this._value, false, true)\n      };\n    }\n  }]);\n  return AddUniqueOp;\n}(Op);\n\nexports.AddUniqueOp = AddUniqueOp;\n\nvar RemoveOp = /*#__PURE__*/function (_Op6) {\n  (0, _inherits2.default)(RemoveOp, _Op6);\n\n  var _super6 = _createSuper(RemoveOp);\n\n  function RemoveOp(value\n  /*: mixed | Array<mixed>*/\n  ) {\n    var _this5;\n\n    (0, _classCallCheck2.default)(this, RemoveOp);\n    _this5 = _super6.call(this);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this5), \"_value\", void 0);\n    _this5._value = (0, _unique.default)((0, _isArray.default)(value) ? value : [value]);\n    return _this5;\n  }\n\n  (0, _createClass2.default)(RemoveOp, [{\n    key: \"applyTo\",\n    value: function (value\n    /*: mixed | Array<mixed>*/\n    )\n    /*: Array<mixed>*/\n    {\n      if (value == null) {\n        return [];\n      }\n\n      if ((0, _isArray.default)(value)) {\n        // var i = value.indexOf(this._value);\n        var removed = (0, _concat.default)(value).call(value, []);\n\n        for (var i = 0; i < this._value.length; i++) {\n          var index = (0, _indexOf.default)(removed).call(removed, this._value[i]);\n\n          while (index > -1) {\n            (0, _splice.default)(removed).call(removed, index, 1);\n            index = (0, _indexOf.default)(removed).call(removed, this._value[i]);\n          }\n\n          if (this._value[i] instanceof _ParseObject.default && this._value[i].id) {\n            for (var j = 0; j < removed.length; j++) {\n              if (removed[j] instanceof _ParseObject.default && this._value[i].id === removed[j].id) {\n                (0, _splice.default)(removed).call(removed, j, 1);\n                j--;\n              }\n            }\n          }\n        }\n\n        return removed;\n      }\n\n      throw new Error('Cannot remove elements from a non-array value');\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function (previous\n    /*: Op*/\n    )\n    /*: Op*/\n    {\n      if (!previous) {\n        return this;\n      }\n\n      if (previous instanceof SetOp) {\n        return new SetOp(this.applyTo(previous._value));\n      }\n\n      if (previous instanceof UnsetOp) {\n        return new UnsetOp();\n      }\n\n      if (previous instanceof RemoveOp) {\n        var _context2;\n\n        var uniques = (0, _concat.default)(_context2 = previous._value).call(_context2, []);\n\n        for (var i = 0; i < this._value.length; i++) {\n          if (this._value[i] instanceof _ParseObject.default) {\n            if (!(0, _arrayContainsObject.default)(uniques, this._value[i])) {\n              uniques.push(this._value[i]);\n            }\n          } else {\n            if ((0, _indexOf.default)(uniques).call(uniques, this._value[i]) < 0) {\n              uniques.push(this._value[i]);\n            }\n          }\n        }\n\n        return new RemoveOp(uniques);\n      }\n\n      throw new Error('Cannot merge Remove Op with the previous Op');\n    }\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: { __op: string, objects: mixed }*/\n    {\n      return {\n        __op: 'Remove',\n        objects: (0, _encode.default)(this._value, false, true)\n      };\n    }\n  }]);\n  return RemoveOp;\n}(Op);\n\nexports.RemoveOp = RemoveOp;\n\nvar RelationOp = /*#__PURE__*/function (_Op7) {\n  (0, _inherits2.default)(RelationOp, _Op7);\n\n  var _super7 = _createSuper(RelationOp);\n\n  function RelationOp(adds\n  /*: Array<ParseObject | string>*/\n  , removes\n  /*: Array<ParseObject | string>*/\n  ) {\n    var _this6;\n\n    (0, _classCallCheck2.default)(this, RelationOp);\n    _this6 = _super7.call(this);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this6), \"_targetClassName\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this6), \"relationsToAdd\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this6), \"relationsToRemove\", void 0);\n    _this6._targetClassName = null;\n\n    if ((0, _isArray.default)(adds)) {\n      _this6.relationsToAdd = (0, _unique.default)((0, _map.default)(adds).call(adds, _this6._extractId, (0, _assertThisInitialized2.default)(_this6)));\n    }\n\n    if ((0, _isArray.default)(removes)) {\n      _this6.relationsToRemove = (0, _unique.default)((0, _map.default)(removes).call(removes, _this6._extractId, (0, _assertThisInitialized2.default)(_this6)));\n    }\n\n    return _this6;\n  }\n\n  (0, _createClass2.default)(RelationOp, [{\n    key: \"_extractId\",\n    value: function (obj\n    /*: string | ParseObject*/\n    )\n    /*: string*/\n    {\n      if (typeof obj === 'string') {\n        return obj;\n      }\n\n      if (!obj.id) {\n        throw new Error('You cannot add or remove an unsaved Parse Object from a relation');\n      }\n\n      if (!this._targetClassName) {\n        this._targetClassName = obj.className;\n      }\n\n      if (this._targetClassName !== obj.className) {\n        throw new Error('Tried to create a Relation with 2 different object types: ' + this._targetClassName + ' and ' + obj.className + '.');\n      }\n\n      return obj.id;\n    }\n  }, {\n    key: \"applyTo\",\n    value: function (value\n    /*: mixed*/\n    , object\n    /*:: ?: { className: string, id: ?string }*/\n    , key\n    /*:: ?: string*/\n    )\n    /*: ?ParseRelation*/\n    {\n      if (!value) {\n        var _context3;\n\n        if (!object || !key) {\n          throw new Error('Cannot apply a RelationOp without either a previous value, or an object and a key');\n        }\n\n        var parent = new _ParseObject.default(object.className);\n\n        if (object.id && (0, _indexOf.default)(_context3 = object.id).call(_context3, 'local') === 0) {\n          parent._localId = object.id;\n        } else if (object.id) {\n          parent.id = object.id;\n        }\n\n        var relation = new _ParseRelation.default(parent, key);\n        relation.targetClassName = this._targetClassName;\n        return relation;\n      }\n\n      if (value instanceof _ParseRelation.default) {\n        if (this._targetClassName) {\n          if (value.targetClassName) {\n            if (this._targetClassName !== value.targetClassName) {\n              throw new Error('Related object must be a ' + value.targetClassName + ', but a ' + this._targetClassName + ' was passed in.');\n            }\n          } else {\n            value.targetClassName = this._targetClassName;\n          }\n        }\n\n        return value;\n      } else {\n        throw new Error('Relation cannot be applied to a non-relation field');\n      }\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function (previous\n    /*: Op*/\n    )\n    /*: Op*/\n    {\n      if (!previous) {\n        return this;\n      } else if (previous instanceof UnsetOp) {\n        throw new Error('You cannot modify a relation after deleting it.');\n      } else if (previous instanceof SetOp && previous._value instanceof _ParseRelation.default) {\n        return this;\n      } else if (previous instanceof RelationOp) {\n        var _context4, _context5, _context6, _context7, _context8, _context9;\n\n        if (previous._targetClassName && previous._targetClassName !== this._targetClassName) {\n          throw new Error('Related object must be of class ' + previous._targetClassName + ', but ' + (this._targetClassName || 'null') + ' was passed in.');\n        }\n\n        var newAdd = (0, _concat.default)(_context4 = previous.relationsToAdd).call(_context4, []);\n        (0, _forEach.default)(_context5 = this.relationsToRemove).call(_context5, function (r) {\n          var index = (0, _indexOf.default)(newAdd).call(newAdd, r);\n\n          if (index > -1) {\n            (0, _splice.default)(newAdd).call(newAdd, index, 1);\n          }\n        });\n        (0, _forEach.default)(_context6 = this.relationsToAdd).call(_context6, function (r) {\n          var index = (0, _indexOf.default)(newAdd).call(newAdd, r);\n\n          if (index < 0) {\n            newAdd.push(r);\n          }\n        });\n        var newRemove = (0, _concat.default)(_context7 = previous.relationsToRemove).call(_context7, []);\n        (0, _forEach.default)(_context8 = this.relationsToAdd).call(_context8, function (r) {\n          var index = (0, _indexOf.default)(newRemove).call(newRemove, r);\n\n          if (index > -1) {\n            (0, _splice.default)(newRemove).call(newRemove, index, 1);\n          }\n        });\n        (0, _forEach.default)(_context9 = this.relationsToRemove).call(_context9, function (r) {\n          var index = (0, _indexOf.default)(newRemove).call(newRemove, r);\n\n          if (index < 0) {\n            newRemove.push(r);\n          }\n        });\n        var newRelation = new RelationOp(newAdd, newRemove);\n        newRelation._targetClassName = this._targetClassName;\n        return newRelation;\n      }\n\n      throw new Error('Cannot merge Relation Op with the previous Op');\n    }\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: { __op?: string, objects?: mixed, ops?: mixed }*/\n    {\n      var _this7 = this;\n\n      var idToPointer = function (id) {\n        return {\n          __type: 'Pointer',\n          className: _this7._targetClassName,\n          objectId: id\n        };\n      };\n\n      var adds = null;\n      var removes = null;\n      var pointers = null;\n\n      if (this.relationsToAdd.length > 0) {\n        var _context10;\n\n        pointers = (0, _map.default)(_context10 = this.relationsToAdd).call(_context10, idToPointer);\n        adds = {\n          __op: 'AddRelation',\n          objects: pointers\n        };\n      }\n\n      if (this.relationsToRemove.length > 0) {\n        var _context11;\n\n        pointers = (0, _map.default)(_context11 = this.relationsToRemove).call(_context11, idToPointer);\n        removes = {\n          __op: 'RemoveRelation',\n          objects: pointers\n        };\n      }\n\n      if (adds && removes) {\n        return {\n          __op: 'Batch',\n          ops: [adds, removes]\n        };\n      }\n\n      return adds || removes || {};\n    }\n  }]);\n  return RelationOp;\n}(Op);\n\nexports.RelationOp = RelationOp;","map":{"version":3,"sources":["/Users/orbiter/Documents/code/baler/node_modules/moralis/lib/browser/ParseOp.js"],"names":["_interopRequireDefault","require","_Object$defineProperty","_Reflect$construct","exports","value","opFromJSON","RelationOp","RemoveOp","AddUniqueOp","AddOp","IncrementOp","UnsetOp","SetOp","Op","_map","_splice","_indexOf","_forEach","_assertThisInitialized2","_inherits2","_possibleConstructorReturn2","_getPrototypeOf2","_defineProperty2","_classCallCheck2","_createClass2","_concat","_isArray","_arrayContainsObject","_decode","_encode","_ParseObject","_ParseRelation","_unique","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","Super","default","result","NewTarget","constructor","arguments","apply","Reflect","sham","Proxy","Date","prototype","toString","call","e","json","__op","amount","objects","toAdd","toRemove","_toAdd","_toRemove","i","ops","length","key","_Op","_super","_this","_value","offline","undefined","_Op2","_super2","_Op3","_super3","_this2","TypeError","_amount","previous","applyTo","Error","_Op4","_super4","_this3","_Op5","_super5","_this4","_context","v","push","_Op6","_super6","_this5","removed","index","id","j","_context2","uniques","_Op7","_super7","adds","removes","_this6","_targetClassName","relationsToAdd","_extractId","relationsToRemove","obj","className","object","_context3","parent","_localId","relation","targetClassName","_context4","_context5","_context6","_context7","_context8","_context9","newAdd","r","newRemove","newRelation","_this7","idToPointer","__type","objectId","pointers","_context10","_context11"],"mappings":"AAAA;;AAEA,IAAIA,sBAAsB,GAAGC,OAAO,CAAC,sDAAD,CAApC;;AAEA,IAAIC,sBAAsB,GAAGD,OAAO,CAAC,8DAAD,CAApC;;AAEA,IAAIE,kBAAkB,GAAGF,OAAO,CAAC,yDAAD,CAAhC;;AAEAC,sBAAsB,CAACE,OAAD,EAAU,YAAV,EAAwB;AAC5CC,EAAAA,KAAK,EAAE;AADqC,CAAxB,CAAtB;;AAIAD,OAAO,CAACE,UAAR,GAAqBA,UAArB;AACAF,OAAO,CAACG,UAAR,GAAqBH,OAAO,CAACI,QAAR,GAAmBJ,OAAO,CAACK,WAAR,GAAsBL,OAAO,CAACM,KAAR,GAAgBN,OAAO,CAACO,WAAR,GAAsBP,OAAO,CAACQ,OAAR,GAAkBR,OAAO,CAACS,KAAR,GAAgBT,OAAO,CAACU,EAAR,GAAa,KAAK,CAAxJ;;AAEA,IAAIC,IAAI,GAAGf,sBAAsB,CAACC,OAAO,CAAC,oDAAD,CAAR,CAAjC;;AAEA,IAAIe,OAAO,GAAGhB,sBAAsB,CAACC,OAAO,CAAC,uDAAD,CAAR,CAApC;;AAEA,IAAIgB,QAAQ,GAAGjB,sBAAsB,CAACC,OAAO,CAAC,yDAAD,CAAR,CAArC;;AAEA,IAAIiB,QAAQ,GAAGlB,sBAAsB,CAACC,OAAO,CAAC,yDAAD,CAAR,CAArC;;AAEA,IAAIkB,uBAAuB,GAAGnB,sBAAsB,CAACC,OAAO,CAAC,sDAAD,CAAR,CAApD;;AAEA,IAAImB,UAAU,GAAGpB,sBAAsB,CAACC,OAAO,CAAC,yCAAD,CAAR,CAAvC;;AAEA,IAAIoB,2BAA2B,GAAGrB,sBAAsB,CAACC,OAAO,CAAC,0DAAD,CAAR,CAAxD;;AAEA,IAAIqB,gBAAgB,GAAGtB,sBAAsB,CAACC,OAAO,CAAC,+CAAD,CAAR,CAA7C;;AAEA,IAAIsB,gBAAgB,GAAGvB,sBAAsB,CAACC,OAAO,CAAC,+CAAD,CAAR,CAA7C;;AAEA,IAAIuB,gBAAgB,GAAGxB,sBAAsB,CAACC,OAAO,CAAC,+CAAD,CAAR,CAA7C;;AAEA,IAAIwB,aAAa,GAAGzB,sBAAsB,CAACC,OAAO,CAAC,4CAAD,CAAR,CAA1C;;AAEA,IAAIyB,OAAO,GAAG1B,sBAAsB,CAACC,OAAO,CAAC,uDAAD,CAAR,CAApC;;AAEA,IAAI0B,QAAQ,GAAG3B,sBAAsB,CAACC,OAAO,CAAC,sDAAD,CAAR,CAArC;;AAEA,IAAI2B,oBAAoB,GAAG5B,sBAAsB,CAACC,OAAO,CAAC,uBAAD,CAAR,CAAjD;;AAEA,IAAI4B,OAAO,GAAG7B,sBAAsB,CAACC,OAAO,CAAC,UAAD,CAAR,CAApC;;AAEA,IAAI6B,OAAO,GAAG9B,sBAAsB,CAACC,OAAO,CAAC,UAAD,CAAR,CAApC;;AAEA,IAAI8B,YAAY,GAAG/B,sBAAsB,CAACC,OAAO,CAAC,eAAD,CAAR,CAAzC;;AAEA,IAAI+B,cAAc,GAAGhC,sBAAsB,CAACC,OAAO,CAAC,iBAAD,CAAR,CAA3C;;AAEA,IAAIgC,OAAO,GAAGjC,sBAAsB,CAACC,OAAO,CAAC,UAAD,CAAR,CAApC;;AAEA,SAASiC,YAAT,CAAsBC,OAAtB,EAA+B;AAC7B,MAAIC,yBAAyB,GAAGC,yBAAyB,EAAzD;;AAEA,SAAO,YAAY;AACjB,QAAIC,KAAK,GAAG,CAAC,GAAGhB,gBAAgB,CAACiB,OAArB,EAA8BJ,OAA9B,CAAZ;AAAA,QACIK,MADJ;;AAGA,QAAIJ,yBAAJ,EAA+B;AAC7B,UAAIK,SAAS,GAAG,CAAC,GAAGnB,gBAAgB,CAACiB,OAArB,EAA8B,IAA9B,EAAoCG,WAApD;AACAF,MAAAA,MAAM,GAAGrC,kBAAkB,CAACmC,KAAD,EAAQK,SAAR,EAAmBF,SAAnB,CAA3B;AACD,KAHD,MAGO;AACLD,MAAAA,MAAM,GAAGF,KAAK,CAACM,KAAN,CAAY,IAAZ,EAAkBD,SAAlB,CAAT;AACD;;AAED,WAAO,CAAC,GAAGtB,2BAA2B,CAACkB,OAAhC,EAAyC,IAAzC,EAA+CC,MAA/C,CAAP;AACD,GAZD;AAaD;;AAED,SAASH,yBAAT,GAAqC;AACnC,MAAI,OAAOQ,OAAP,KAAmB,WAAnB,IAAkC,CAAC1C,kBAAvC,EAA2D,OAAO,KAAP;AAC3D,MAAIA,kBAAkB,CAAC2C,IAAvB,EAA6B,OAAO,KAAP;AAC7B,MAAI,OAAOC,KAAP,KAAiB,UAArB,EAAiC,OAAO,IAAP;;AAEjC,MAAI;AACFC,IAAAA,IAAI,CAACC,SAAL,CAAeC,QAAf,CAAwBC,IAAxB,CAA6BhD,kBAAkB,CAAC6C,IAAD,EAAO,EAAP,EAAW,YAAY,CAAE,CAAzB,CAA/C;AACA,WAAO,IAAP;AACD,GAHD,CAGE,OAAOI,CAAP,EAAU;AACV,WAAO,KAAP;AACD;AACF;;AAED,SAAS9C,UAAT,CAAoB+C;AACpB;AADA;AAGA;AACA;AACE,MAAI,CAACA,IAAD,IAAS,CAACA,IAAI,CAACC,IAAnB,EAAyB;AACvB,WAAO,IAAP;AACD;;AAED,UAAQD,IAAI,CAACC,IAAb;AACE,SAAK,QAAL;AACE,aAAO,IAAI1C,OAAJ,EAAP;;AAEF,SAAK,WAAL;AACE,aAAO,IAAID,WAAJ,CAAgB0C,IAAI,CAACE,MAArB,CAAP;;AAEF,SAAK,KAAL;AACE,aAAO,IAAI7C,KAAJ,CAAU,CAAC,GAAGmB,OAAO,CAACU,OAAZ,EAAqBc,IAAI,CAACG,OAA1B,CAAV,CAAP;;AAEF,SAAK,WAAL;AACE,aAAO,IAAI/C,WAAJ,CAAgB,CAAC,GAAGoB,OAAO,CAACU,OAAZ,EAAqBc,IAAI,CAACG,OAA1B,CAAhB,CAAP;;AAEF,SAAK,QAAL;AACE,aAAO,IAAIhD,QAAJ,CAAa,CAAC,GAAGqB,OAAO,CAACU,OAAZ,EAAqBc,IAAI,CAACG,OAA1B,CAAb,CAAP;;AAEF,SAAK,aAAL;AACE;AACE,YAAIC,KAAK,GAAG,CAAC,GAAG5B,OAAO,CAACU,OAAZ,EAAqBc,IAAI,CAACG,OAA1B,CAAZ;;AAEA,YAAI,CAAC,CAAC,GAAG7B,QAAQ,CAACY,OAAb,EAAsBkB,KAAtB,CAAL,EAAmC;AACjC,iBAAO,IAAIlD,UAAJ,CAAe,EAAf,EAAmB,EAAnB,CAAP;AACD;;AAED,eAAO,IAAIA,UAAJ,CAAekD,KAAf,EAAsB,EAAtB,CAAP;AACD;;AAEH,SAAK,gBAAL;AACE;AACE,YAAIC,QAAQ,GAAG,CAAC,GAAG7B,OAAO,CAACU,OAAZ,EAAqBc,IAAI,CAACG,OAA1B,CAAf;;AAEA,YAAI,CAAC,CAAC,GAAG7B,QAAQ,CAACY,OAAb,EAAsBmB,QAAtB,CAAL,EAAsC;AACpC,iBAAO,IAAInD,UAAJ,CAAe,EAAf,EAAmB,EAAnB,CAAP;AACD;;AAED,eAAO,IAAIA,UAAJ,CAAe,EAAf,EAAmBmD,QAAnB,CAAP;AACD;;AAEH,SAAK,OAAL;AACE;AACE,YAAIC,MAAM,GAAG,EAAb;AACA,YAAIC,SAAS,GAAG,EAAhB;;AAEA,aAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,IAAI,CAACS,GAAL,CAASC,MAA7B,EAAqCF,CAAC,EAAtC,EAA0C;AACxC,cAAIR,IAAI,CAACS,GAAL,CAASD,CAAT,EAAYP,IAAZ,KAAqB,aAAzB,EAAwC;AACtCK,YAAAA,MAAM,GAAG,CAAC,GAAGjC,OAAO,CAACa,OAAZ,EAAqBoB,MAArB,EAA6BR,IAA7B,CAAkCQ,MAAlC,EAA0C,CAAC,GAAG9B,OAAO,CAACU,OAAZ,EAAqBc,IAAI,CAACS,GAAL,CAASD,CAAT,EAAYL,OAAjC,CAA1C,CAAT;AACD,WAFD,MAEO,IAAIH,IAAI,CAACS,GAAL,CAASD,CAAT,EAAYP,IAAZ,KAAqB,gBAAzB,EAA2C;AAChDM,YAAAA,SAAS,GAAG,CAAC,GAAGlC,OAAO,CAACa,OAAZ,EAAqBqB,SAArB,EAAgCT,IAAhC,CAAqCS,SAArC,EAAgD,CAAC,GAAG/B,OAAO,CAACU,OAAZ,EAAqBc,IAAI,CAACS,GAAL,CAASD,CAAT,EAAYL,OAAjC,CAAhD,CAAZ;AACD;AACF;;AAED,eAAO,IAAIjD,UAAJ,CAAeoD,MAAf,EAAuBC,SAAvB,CAAP;AACD;AApDL;;AAuDA,SAAO,IAAP;AACD;;AAED,IAAI9C,EAAE,GAAG,aAAa,YAAY;AAChC,WAASA,EAAT,GAAc;AACZ,KAAC,GAAGU,gBAAgB,CAACe,OAArB,EAA8B,IAA9B,EAAoCzB,EAApC;AACD;;AAED,GAAC,GAAGW,aAAa,CAACc,OAAlB,EAA2BzB,EAA3B,EAA+B,CAAC;AAC9BkD,IAAAA,GAAG,EAAE,SADyB;AAE9B3D,IAAAA,KAAK,EAAE;AACP;AACA;;AAEA;AACA,KAAE;AACF;;AAR8B,GAAD,EAU5B;AACD2D,IAAAA,GAAG,EAAE,WADJ;AAED3D,IAAAA,KAAK,EAAE;AACP;;AAEA;AACA,KAAE;AACF;;AAPC,GAV4B,EAmB5B;AACD2D,IAAAA,GAAG,EAAE,QADJ;AAED3D,IAAAA,KAAK,EAAE;AACP;AACA,KAAE;AAJD,GAnB4B,CAA/B;AAyBA,SAAOS,EAAP;AACD,CA/BqB,EAAtB;;AAiCAV,OAAO,CAACU,EAAR,GAAaA,EAAb;;AAEA,IAAID,KAAK,GAAG,aAAa,UAAUoD,GAAV,EAAe;AACtC,GAAC,GAAG7C,UAAU,CAACmB,OAAf,EAAwB1B,KAAxB,EAA+BoD,GAA/B;;AAEA,MAAIC,MAAM,GAAGhC,YAAY,CAACrB,KAAD,CAAzB;;AAEA,WAASA,KAAT,CAAeR;AACf;AADA,IAEE;AACA,QAAI8D,KAAJ;;AAEA,KAAC,GAAG3C,gBAAgB,CAACe,OAArB,EAA8B,IAA9B,EAAoC1B,KAApC;AACAsD,IAAAA,KAAK,GAAGD,MAAM,CAACf,IAAP,CAAY,IAAZ,CAAR;AACA,KAAC,GAAG5B,gBAAgB,CAACgB,OAArB,EAA8B,CAAC,GAAGpB,uBAAuB,CAACoB,OAA5B,EAAqC4B,KAArC,CAA9B,EAA2E,QAA3E,EAAqF,KAAK,CAA1F;AACAA,IAAAA,KAAK,CAACC,MAAN,GAAe/D,KAAf;AACA,WAAO8D,KAAP;AACD;;AAED,GAAC,GAAG1C,aAAa,CAACc,OAAlB,EAA2B1B,KAA3B,EAAkC,CAAC;AACjCmD,IAAAA,GAAG,EAAE,SAD4B;AAEjC3D,IAAAA,KAAK,EAAE;AACP;AACA;AACE,aAAO,KAAK+D,MAAZ;AACD;AANgC,GAAD,EAO/B;AACDJ,IAAAA,GAAG,EAAE,WADJ;AAED3D,IAAAA,KAAK,EAAE;AACP;AACA;AACE,aAAO,IAAIQ,KAAJ,CAAU,KAAKuD,MAAf,CAAP;AACD;AANA,GAP+B,EAc/B;AACDJ,IAAAA,GAAG,EAAE,QADJ;AAED3D,IAAAA,KAAK,EAAE,UAAUgE;AACjB;AADO,MAEL;AACA,aAAO,CAAC,GAAGvC,OAAO,CAACS,OAAZ,EAAqB,KAAK6B,MAA1B,EAAkC,KAAlC,EAAyC,IAAzC,EAA+CE,SAA/C,EAA0DD,OAA1D,CAAP;AACD;AANA,GAd+B,CAAlC;AAsBA,SAAOxD,KAAP;AACD,CAxCwB,CAwCvBC,EAxCuB,CAAzB;;AA0CAV,OAAO,CAACS,KAAR,GAAgBA,KAAhB;;AAEA,IAAID,OAAO,GAAG,aAAa,UAAU2D,IAAV,EAAgB;AACzC,GAAC,GAAGnD,UAAU,CAACmB,OAAf,EAAwB3B,OAAxB,EAAiC2D,IAAjC;;AAEA,MAAIC,OAAO,GAAGtC,YAAY,CAACtB,OAAD,CAA1B;;AAEA,WAASA,OAAT,GAAmB;AACjB,KAAC,GAAGY,gBAAgB,CAACe,OAArB,EAA8B,IAA9B,EAAoC3B,OAApC;AACA,WAAO4D,OAAO,CAAC5B,KAAR,CAAc,IAAd,EAAoBD,SAApB,CAAP;AACD;;AAED,GAAC,GAAGlB,aAAa,CAACc,OAAlB,EAA2B3B,OAA3B,EAAoC,CAAC;AACnCoD,IAAAA,GAAG,EAAE,SAD8B;AAEnC3D,IAAAA,KAAK,EAAE,YAAY;AACjB,aAAOiE,SAAP;AACD;AAJkC,GAAD,EAKjC;AACDN,IAAAA,GAAG,EAAE,WADJ;AAED3D,IAAAA,KAAK,EAAE;AACP;AACA;AACE,aAAO,IAAIO,OAAJ,EAAP;AACD;AANA,GALiC,EAYjC;AACDoD,IAAAA,GAAG,EAAE,QADJ;AAED3D,IAAAA,KAAK,EAAE;AACP;AACA;AACE,aAAO;AACLiD,QAAAA,IAAI,EAAE;AADD,OAAP;AAGD;AARA,GAZiC,CAApC;AAsBA,SAAO1C,OAAP;AACD,CAjC0B,CAiCzBE,EAjCyB,CAA3B;;AAmCAV,OAAO,CAACQ,OAAR,GAAkBA,OAAlB;;AAEA,IAAID,WAAW,GAAG,aAAa,UAAU8D,IAAV,EAAgB;AAC7C,GAAC,GAAGrD,UAAU,CAACmB,OAAf,EAAwB5B,WAAxB,EAAqC8D,IAArC;;AAEA,MAAIC,OAAO,GAAGxC,YAAY,CAACvB,WAAD,CAA1B;;AAEA,WAASA,WAAT,CAAqB4C;AACrB;AADA,IAEE;AACA,QAAIoB,MAAJ;;AAEA,KAAC,GAAGnD,gBAAgB,CAACe,OAArB,EAA8B,IAA9B,EAAoC5B,WAApC;AACAgE,IAAAA,MAAM,GAAGD,OAAO,CAACvB,IAAR,CAAa,IAAb,CAAT;AACA,KAAC,GAAG5B,gBAAgB,CAACgB,OAArB,EAA8B,CAAC,GAAGpB,uBAAuB,CAACoB,OAA5B,EAAqCoC,MAArC,CAA9B,EAA4E,SAA5E,EAAuF,KAAK,CAA5F;;AAEA,QAAI,OAAOpB,MAAP,KAAkB,QAAtB,EAAgC;AAC9B,YAAM,IAAIqB,SAAJ,CAAc,yDAAd,CAAN;AACD;;AAEDD,IAAAA,MAAM,CAACE,OAAP,GAAiBtB,MAAjB;AACA,WAAOoB,MAAP;AACD;;AAED,GAAC,GAAGlD,aAAa,CAACc,OAAlB,EAA2B5B,WAA3B,EAAwC,CAAC;AACvCqD,IAAAA,GAAG,EAAE,SADkC;AAEvC3D,IAAAA,KAAK,EAAE,UAAUA;AACjB;AADO;AAGP;AACA;AACE,UAAI,OAAOA,KAAP,KAAiB,WAArB,EAAkC;AAChC,eAAO,KAAKwE,OAAZ;AACD;;AAED,UAAI,OAAOxE,KAAP,KAAiB,QAArB,EAA+B;AAC7B,cAAM,IAAIuE,SAAJ,CAAc,uCAAd,CAAN;AACD;;AAED,aAAO,KAAKC,OAAL,GAAexE,KAAtB;AACD;AAhBsC,GAAD,EAiBrC;AACD2D,IAAAA,GAAG,EAAE,WADJ;AAED3D,IAAAA,KAAK,EAAE,UAAUyE;AACjB;AADO;AAGP;AACA;AACE,UAAI,CAACA,QAAL,EAAe;AACb,eAAO,IAAP;AACD;;AAED,UAAIA,QAAQ,YAAYjE,KAAxB,EAA+B;AAC7B,eAAO,IAAIA,KAAJ,CAAU,KAAKkE,OAAL,CAAaD,QAAQ,CAACV,MAAtB,CAAV,CAAP;AACD;;AAED,UAAIU,QAAQ,YAAYlE,OAAxB,EAAiC;AAC/B,eAAO,IAAIC,KAAJ,CAAU,KAAKgE,OAAf,CAAP;AACD;;AAED,UAAIC,QAAQ,YAAYnE,WAAxB,EAAqC;AACnC,eAAO,IAAIA,WAAJ,CAAgB,KAAKoE,OAAL,CAAaD,QAAQ,CAACD,OAAtB,CAAhB,CAAP;AACD;;AAED,YAAM,IAAIG,KAAJ,CAAU,gDAAV,CAAN;AACD;AAxBA,GAjBqC,EA0CrC;AACDhB,IAAAA,GAAG,EAAE,QADJ;AAED3D,IAAAA,KAAK,EAAE;AACP;AACA;AACE,aAAO;AACLiD,QAAAA,IAAI,EAAE,WADD;AAELC,QAAAA,MAAM,EAAE,KAAKsB;AAFR,OAAP;AAID;AATA,GA1CqC,CAAxC;AAqDA,SAAOlE,WAAP;AACD,CA5E8B,CA4E7BG,EA5E6B,CAA/B;;AA8EAV,OAAO,CAACO,WAAR,GAAsBA,WAAtB;;AAEA,IAAID,KAAK,GAAG,aAAa,UAAUuE,IAAV,EAAgB;AACvC,GAAC,GAAG7D,UAAU,CAACmB,OAAf,EAAwB7B,KAAxB,EAA+BuE,IAA/B;;AAEA,MAAIC,OAAO,GAAGhD,YAAY,CAACxB,KAAD,CAA1B;;AAEA,WAASA,KAAT,CAAeL;AACf;AADA,IAEE;AACA,QAAI8E,MAAJ;;AAEA,KAAC,GAAG3D,gBAAgB,CAACe,OAArB,EAA8B,IAA9B,EAAoC7B,KAApC;AACAyE,IAAAA,MAAM,GAAGD,OAAO,CAAC/B,IAAR,CAAa,IAAb,CAAT;AACA,KAAC,GAAG5B,gBAAgB,CAACgB,OAArB,EAA8B,CAAC,GAAGpB,uBAAuB,CAACoB,OAA5B,EAAqC4C,MAArC,CAA9B,EAA4E,QAA5E,EAAsF,KAAK,CAA3F;AACAA,IAAAA,MAAM,CAACf,MAAP,GAAgB,CAAC,GAAGzC,QAAQ,CAACY,OAAb,EAAsBlC,KAAtB,IAA+BA,KAA/B,GAAuC,CAACA,KAAD,CAAvD;AACA,WAAO8E,MAAP;AACD;;AAED,GAAC,GAAG1D,aAAa,CAACc,OAAlB,EAA2B7B,KAA3B,EAAkC,CAAC;AACjCsD,IAAAA,GAAG,EAAE,SAD4B;AAEjC3D,IAAAA,KAAK,EAAE,UAAUA;AACjB;AADO;AAGP;AACA;AACE,UAAIA,KAAK,IAAI,IAAb,EAAmB;AACjB,eAAO,KAAK+D,MAAZ;AACD;;AAED,UAAI,CAAC,GAAGzC,QAAQ,CAACY,OAAb,EAAsBlC,KAAtB,CAAJ,EAAkC;AAChC,eAAO,CAAC,GAAGqB,OAAO,CAACa,OAAZ,EAAqBlC,KAArB,EAA4B8C,IAA5B,CAAiC9C,KAAjC,EAAwC,KAAK+D,MAA7C,CAAP;AACD;;AAED,YAAM,IAAIY,KAAJ,CAAU,0CAAV,CAAN;AACD;AAhBgC,GAAD,EAiB/B;AACDhB,IAAAA,GAAG,EAAE,WADJ;AAED3D,IAAAA,KAAK,EAAE,UAAUyE;AACjB;AADO;AAGP;AACA;AACE,UAAI,CAACA,QAAL,EAAe;AACb,eAAO,IAAP;AACD;;AAED,UAAIA,QAAQ,YAAYjE,KAAxB,EAA+B;AAC7B,eAAO,IAAIA,KAAJ,CAAU,KAAKkE,OAAL,CAAaD,QAAQ,CAACV,MAAtB,CAAV,CAAP;AACD;;AAED,UAAIU,QAAQ,YAAYlE,OAAxB,EAAiC;AAC/B,eAAO,IAAIC,KAAJ,CAAU,KAAKuD,MAAf,CAAP;AACD;;AAED,UAAIU,QAAQ,YAAYpE,KAAxB,EAA+B;AAC7B,eAAO,IAAIA,KAAJ,CAAU,KAAKqE,OAAL,CAAaD,QAAQ,CAACV,MAAtB,CAAV,CAAP;AACD;;AAED,YAAM,IAAIY,KAAJ,CAAU,0CAAV,CAAN;AACD;AAxBA,GAjB+B,EA0C/B;AACDhB,IAAAA,GAAG,EAAE,QADJ;AAED3D,IAAAA,KAAK,EAAE;AACP;AACA;AACE,aAAO;AACLiD,QAAAA,IAAI,EAAE,KADD;AAELE,QAAAA,OAAO,EAAE,CAAC,GAAG1B,OAAO,CAACS,OAAZ,EAAqB,KAAK6B,MAA1B,EAAkC,KAAlC,EAAyC,IAAzC;AAFJ,OAAP;AAID;AATA,GA1C+B,CAAlC;AAqDA,SAAO1D,KAAP;AACD,CAvEwB,CAuEvBI,EAvEuB,CAAzB;;AAyEAV,OAAO,CAACM,KAAR,GAAgBA,KAAhB;;AAEA,IAAID,WAAW,GAAG,aAAa,UAAU2E,IAAV,EAAgB;AAC7C,GAAC,GAAGhE,UAAU,CAACmB,OAAf,EAAwB9B,WAAxB,EAAqC2E,IAArC;;AAEA,MAAIC,OAAO,GAAGnD,YAAY,CAACzB,WAAD,CAA1B;;AAEA,WAASA,WAAT,CAAqBJ;AACrB;AADA,IAEE;AACA,QAAIiF,MAAJ;;AAEA,KAAC,GAAG9D,gBAAgB,CAACe,OAArB,EAA8B,IAA9B,EAAoC9B,WAApC;AACA6E,IAAAA,MAAM,GAAGD,OAAO,CAAClC,IAAR,CAAa,IAAb,CAAT;AACA,KAAC,GAAG5B,gBAAgB,CAACgB,OAArB,EAA8B,CAAC,GAAGpB,uBAAuB,CAACoB,OAA5B,EAAqC+C,MAArC,CAA9B,EAA4E,QAA5E,EAAsF,KAAK,CAA3F;AACAA,IAAAA,MAAM,CAAClB,MAAP,GAAgB,CAAC,GAAGnC,OAAO,CAACM,OAAZ,EAAqB,CAAC,GAAGZ,QAAQ,CAACY,OAAb,EAAsBlC,KAAtB,IAA+BA,KAA/B,GAAuC,CAACA,KAAD,CAA5D,CAAhB;AACA,WAAOiF,MAAP;AACD;;AAED,GAAC,GAAG7D,aAAa,CAACc,OAAlB,EAA2B9B,WAA3B,EAAwC,CAAC;AACvCuD,IAAAA,GAAG,EAAE,SADkC;AAEvC3D,IAAAA,KAAK,EAAE,UAAUA;AACjB;AADO;AAGP;AACA;AACE,UAAIA,KAAK,IAAI,IAAb,EAAmB;AACjB,eAAO,KAAK+D,MAAL,IAAe,EAAtB;AACD;;AAED,UAAI,CAAC,GAAGzC,QAAQ,CAACY,OAAb,EAAsBlC,KAAtB,CAAJ,EAAkC;AAChC,YAAIkF,QAAJ;;AAEA,YAAI9B,KAAK,GAAG,EAAZ;AACA,SAAC,GAAGvC,QAAQ,CAACqB,OAAb,EAAsBgD,QAAQ,GAAG,KAAKnB,MAAtC,EAA8CjB,IAA9C,CAAmDoC,QAAnD,EAA6D,UAAUC,CAAV,EAAa;AACxE,cAAIA,CAAC,YAAYzD,YAAY,CAACQ,OAA9B,EAAuC;AACrC,gBAAI,CAAC,CAAC,GAAGX,oBAAoB,CAACW,OAAzB,EAAkClC,KAAlC,EAAyCmF,CAAzC,CAAL,EAAkD;AAChD/B,cAAAA,KAAK,CAACgC,IAAN,CAAWD,CAAX;AACD;AACF,WAJD,MAIO;AACL,gBAAI,CAAC,GAAGvE,QAAQ,CAACsB,OAAb,EAAsBlC,KAAtB,EAA6B8C,IAA7B,CAAkC9C,KAAlC,EAAyCmF,CAAzC,IAA8C,CAAlD,EAAqD;AACnD/B,cAAAA,KAAK,CAACgC,IAAN,CAAWD,CAAX;AACD;AACF;AACF,SAVD;AAWA,eAAO,CAAC,GAAG9D,OAAO,CAACa,OAAZ,EAAqBlC,KAArB,EAA4B8C,IAA5B,CAAiC9C,KAAjC,EAAwCoD,KAAxC,CAAP;AACD;;AAED,YAAM,IAAIuB,KAAJ,CAAU,0CAAV,CAAN;AACD;AA9BsC,GAAD,EA+BrC;AACDhB,IAAAA,GAAG,EAAE,WADJ;AAED3D,IAAAA,KAAK,EAAE,UAAUyE;AACjB;AADO;AAGP;AACA;AACE,UAAI,CAACA,QAAL,EAAe;AACb,eAAO,IAAP;AACD;;AAED,UAAIA,QAAQ,YAAYjE,KAAxB,EAA+B;AAC7B,eAAO,IAAIA,KAAJ,CAAU,KAAKkE,OAAL,CAAaD,QAAQ,CAACV,MAAtB,CAAV,CAAP;AACD;;AAED,UAAIU,QAAQ,YAAYlE,OAAxB,EAAiC;AAC/B,eAAO,IAAIC,KAAJ,CAAU,KAAKuD,MAAf,CAAP;AACD;;AAED,UAAIU,QAAQ,YAAYrE,WAAxB,EAAqC;AACnC,eAAO,IAAIA,WAAJ,CAAgB,KAAKsE,OAAL,CAAaD,QAAQ,CAACV,MAAtB,CAAhB,CAAP;AACD;;AAED,YAAM,IAAIY,KAAJ,CAAU,gDAAV,CAAN;AACD;AAxBA,GA/BqC,EAwDrC;AACDhB,IAAAA,GAAG,EAAE,QADJ;AAED3D,IAAAA,KAAK,EAAE;AACP;AACA;AACE,aAAO;AACLiD,QAAAA,IAAI,EAAE,WADD;AAELE,QAAAA,OAAO,EAAE,CAAC,GAAG1B,OAAO,CAACS,OAAZ,EAAqB,KAAK6B,MAA1B,EAAkC,KAAlC,EAAyC,IAAzC;AAFJ,OAAP;AAID;AATA,GAxDqC,CAAxC;AAmEA,SAAO3D,WAAP;AACD,CArF8B,CAqF7BK,EArF6B,CAA/B;;AAuFAV,OAAO,CAACK,WAAR,GAAsBA,WAAtB;;AAEA,IAAID,QAAQ,GAAG,aAAa,UAAUkF,IAAV,EAAgB;AAC1C,GAAC,GAAGtE,UAAU,CAACmB,OAAf,EAAwB/B,QAAxB,EAAkCkF,IAAlC;;AAEA,MAAIC,OAAO,GAAGzD,YAAY,CAAC1B,QAAD,CAA1B;;AAEA,WAASA,QAAT,CAAkBH;AAClB;AADA,IAEE;AACA,QAAIuF,MAAJ;;AAEA,KAAC,GAAGpE,gBAAgB,CAACe,OAArB,EAA8B,IAA9B,EAAoC/B,QAApC;AACAoF,IAAAA,MAAM,GAAGD,OAAO,CAACxC,IAAR,CAAa,IAAb,CAAT;AACA,KAAC,GAAG5B,gBAAgB,CAACgB,OAArB,EAA8B,CAAC,GAAGpB,uBAAuB,CAACoB,OAA5B,EAAqCqD,MAArC,CAA9B,EAA4E,QAA5E,EAAsF,KAAK,CAA3F;AACAA,IAAAA,MAAM,CAACxB,MAAP,GAAgB,CAAC,GAAGnC,OAAO,CAACM,OAAZ,EAAqB,CAAC,GAAGZ,QAAQ,CAACY,OAAb,EAAsBlC,KAAtB,IAA+BA,KAA/B,GAAuC,CAACA,KAAD,CAA5D,CAAhB;AACA,WAAOuF,MAAP;AACD;;AAED,GAAC,GAAGnE,aAAa,CAACc,OAAlB,EAA2B/B,QAA3B,EAAqC,CAAC;AACpCwD,IAAAA,GAAG,EAAE,SAD+B;AAEpC3D,IAAAA,KAAK,EAAE,UAAUA;AACjB;AADO;AAGP;AACA;AACE,UAAIA,KAAK,IAAI,IAAb,EAAmB;AACjB,eAAO,EAAP;AACD;;AAED,UAAI,CAAC,GAAGsB,QAAQ,CAACY,OAAb,EAAsBlC,KAAtB,CAAJ,EAAkC;AAChC;AACA,YAAIwF,OAAO,GAAG,CAAC,GAAGnE,OAAO,CAACa,OAAZ,EAAqBlC,KAArB,EAA4B8C,IAA5B,CAAiC9C,KAAjC,EAAwC,EAAxC,CAAd;;AAEA,aAAK,IAAIwD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKO,MAAL,CAAYL,MAAhC,EAAwCF,CAAC,EAAzC,EAA6C;AAC3C,cAAIiC,KAAK,GAAG,CAAC,GAAG7E,QAAQ,CAACsB,OAAb,EAAsBsD,OAAtB,EAA+B1C,IAA/B,CAAoC0C,OAApC,EAA6C,KAAKzB,MAAL,CAAYP,CAAZ,CAA7C,CAAZ;;AAEA,iBAAOiC,KAAK,GAAG,CAAC,CAAhB,EAAmB;AACjB,aAAC,GAAG9E,OAAO,CAACuB,OAAZ,EAAqBsD,OAArB,EAA8B1C,IAA9B,CAAmC0C,OAAnC,EAA4CC,KAA5C,EAAmD,CAAnD;AACAA,YAAAA,KAAK,GAAG,CAAC,GAAG7E,QAAQ,CAACsB,OAAb,EAAsBsD,OAAtB,EAA+B1C,IAA/B,CAAoC0C,OAApC,EAA6C,KAAKzB,MAAL,CAAYP,CAAZ,CAA7C,CAAR;AACD;;AAED,cAAI,KAAKO,MAAL,CAAYP,CAAZ,aAA0B9B,YAAY,CAACQ,OAAvC,IAAkD,KAAK6B,MAAL,CAAYP,CAAZ,EAAekC,EAArE,EAAyE;AACvE,iBAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,OAAO,CAAC9B,MAA5B,EAAoCiC,CAAC,EAArC,EAAyC;AACvC,kBAAIH,OAAO,CAACG,CAAD,CAAP,YAAsBjE,YAAY,CAACQ,OAAnC,IAA8C,KAAK6B,MAAL,CAAYP,CAAZ,EAAekC,EAAf,KAAsBF,OAAO,CAACG,CAAD,CAAP,CAAWD,EAAnF,EAAuF;AACrF,iBAAC,GAAG/E,OAAO,CAACuB,OAAZ,EAAqBsD,OAArB,EAA8B1C,IAA9B,CAAmC0C,OAAnC,EAA4CG,CAA5C,EAA+C,CAA/C;AACAA,gBAAAA,CAAC;AACF;AACF;AACF;AACF;;AAED,eAAOH,OAAP;AACD;;AAED,YAAM,IAAIb,KAAJ,CAAU,+CAAV,CAAN;AACD;AArCmC,GAAD,EAsClC;AACDhB,IAAAA,GAAG,EAAE,WADJ;AAED3D,IAAAA,KAAK,EAAE,UAAUyE;AACjB;AADO;AAGP;AACA;AACE,UAAI,CAACA,QAAL,EAAe;AACb,eAAO,IAAP;AACD;;AAED,UAAIA,QAAQ,YAAYjE,KAAxB,EAA+B;AAC7B,eAAO,IAAIA,KAAJ,CAAU,KAAKkE,OAAL,CAAaD,QAAQ,CAACV,MAAtB,CAAV,CAAP;AACD;;AAED,UAAIU,QAAQ,YAAYlE,OAAxB,EAAiC;AAC/B,eAAO,IAAIA,OAAJ,EAAP;AACD;;AAED,UAAIkE,QAAQ,YAAYtE,QAAxB,EAAkC;AAChC,YAAIyF,SAAJ;;AAEA,YAAIC,OAAO,GAAG,CAAC,GAAGxE,OAAO,CAACa,OAAZ,EAAqB0D,SAAS,GAAGnB,QAAQ,CAACV,MAA1C,EAAkDjB,IAAlD,CAAuD8C,SAAvD,EAAkE,EAAlE,CAAd;;AAEA,aAAK,IAAIpC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKO,MAAL,CAAYL,MAAhC,EAAwCF,CAAC,EAAzC,EAA6C;AAC3C,cAAI,KAAKO,MAAL,CAAYP,CAAZ,aAA0B9B,YAAY,CAACQ,OAA3C,EAAoD;AAClD,gBAAI,CAAC,CAAC,GAAGX,oBAAoB,CAACW,OAAzB,EAAkC2D,OAAlC,EAA2C,KAAK9B,MAAL,CAAYP,CAAZ,CAA3C,CAAL,EAAiE;AAC/DqC,cAAAA,OAAO,CAACT,IAAR,CAAa,KAAKrB,MAAL,CAAYP,CAAZ,CAAb;AACD;AACF,WAJD,MAIO;AACL,gBAAI,CAAC,GAAG5C,QAAQ,CAACsB,OAAb,EAAsB2D,OAAtB,EAA+B/C,IAA/B,CAAoC+C,OAApC,EAA6C,KAAK9B,MAAL,CAAYP,CAAZ,CAA7C,IAA+D,CAAnE,EAAsE;AACpEqC,cAAAA,OAAO,CAACT,IAAR,CAAa,KAAKrB,MAAL,CAAYP,CAAZ,CAAb;AACD;AACF;AACF;;AAED,eAAO,IAAIrD,QAAJ,CAAa0F,OAAb,CAAP;AACD;;AAED,YAAM,IAAIlB,KAAJ,CAAU,6CAAV,CAAN;AACD;AAxCA,GAtCkC,EA+ElC;AACDhB,IAAAA,GAAG,EAAE,QADJ;AAED3D,IAAAA,KAAK,EAAE;AACP;AACA;AACE,aAAO;AACLiD,QAAAA,IAAI,EAAE,QADD;AAELE,QAAAA,OAAO,EAAE,CAAC,GAAG1B,OAAO,CAACS,OAAZ,EAAqB,KAAK6B,MAA1B,EAAkC,KAAlC,EAAyC,IAAzC;AAFJ,OAAP;AAID;AATA,GA/EkC,CAArC;AA0FA,SAAO5D,QAAP;AACD,CA5G2B,CA4G1BM,EA5G0B,CAA5B;;AA8GAV,OAAO,CAACI,QAAR,GAAmBA,QAAnB;;AAEA,IAAID,UAAU,GAAG,aAAa,UAAU4F,IAAV,EAAgB;AAC5C,GAAC,GAAG/E,UAAU,CAACmB,OAAf,EAAwBhC,UAAxB,EAAoC4F,IAApC;;AAEA,MAAIC,OAAO,GAAGlE,YAAY,CAAC3B,UAAD,CAA1B;;AAEA,WAASA,UAAT,CAAoB8F;AACpB;AADA,IAEEC;AACF;AAHA,IAIE;AACA,QAAIC,MAAJ;;AAEA,KAAC,GAAG/E,gBAAgB,CAACe,OAArB,EAA8B,IAA9B,EAAoChC,UAApC;AACAgG,IAAAA,MAAM,GAAGH,OAAO,CAACjD,IAAR,CAAa,IAAb,CAAT;AACA,KAAC,GAAG5B,gBAAgB,CAACgB,OAArB,EAA8B,CAAC,GAAGpB,uBAAuB,CAACoB,OAA5B,EAAqCgE,MAArC,CAA9B,EAA4E,kBAA5E,EAAgG,KAAK,CAArG;AACA,KAAC,GAAGhF,gBAAgB,CAACgB,OAArB,EAA8B,CAAC,GAAGpB,uBAAuB,CAACoB,OAA5B,EAAqCgE,MAArC,CAA9B,EAA4E,gBAA5E,EAA8F,KAAK,CAAnG;AACA,KAAC,GAAGhF,gBAAgB,CAACgB,OAArB,EAA8B,CAAC,GAAGpB,uBAAuB,CAACoB,OAA5B,EAAqCgE,MAArC,CAA9B,EAA4E,mBAA5E,EAAiG,KAAK,CAAtG;AACAA,IAAAA,MAAM,CAACC,gBAAP,GAA0B,IAA1B;;AAEA,QAAI,CAAC,GAAG7E,QAAQ,CAACY,OAAb,EAAsB8D,IAAtB,CAAJ,EAAiC;AAC/BE,MAAAA,MAAM,CAACE,cAAP,GAAwB,CAAC,GAAGxE,OAAO,CAACM,OAAZ,EAAqB,CAAC,GAAGxB,IAAI,CAACwB,OAAT,EAAkB8D,IAAlB,EAAwBlD,IAAxB,CAA6BkD,IAA7B,EAAmCE,MAAM,CAACG,UAA1C,EAAsD,CAAC,GAAGvF,uBAAuB,CAACoB,OAA5B,EAAqCgE,MAArC,CAAtD,CAArB,CAAxB;AACD;;AAED,QAAI,CAAC,GAAG5E,QAAQ,CAACY,OAAb,EAAsB+D,OAAtB,CAAJ,EAAoC;AAClCC,MAAAA,MAAM,CAACI,iBAAP,GAA2B,CAAC,GAAG1E,OAAO,CAACM,OAAZ,EAAqB,CAAC,GAAGxB,IAAI,CAACwB,OAAT,EAAkB+D,OAAlB,EAA2BnD,IAA3B,CAAgCmD,OAAhC,EAAyCC,MAAM,CAACG,UAAhD,EAA4D,CAAC,GAAGvF,uBAAuB,CAACoB,OAA5B,EAAqCgE,MAArC,CAA5D,CAArB,CAA3B;AACD;;AAED,WAAOA,MAAP;AACD;;AAED,GAAC,GAAG9E,aAAa,CAACc,OAAlB,EAA2BhC,UAA3B,EAAuC,CAAC;AACtCyD,IAAAA,GAAG,EAAE,YADiC;AAEtC3D,IAAAA,KAAK,EAAE,UAAUuG;AACjB;AADO;AAGP;AACA;AACE,UAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;AAC3B,eAAOA,GAAP;AACD;;AAED,UAAI,CAACA,GAAG,CAACb,EAAT,EAAa;AACX,cAAM,IAAIf,KAAJ,CAAU,kEAAV,CAAN;AACD;;AAED,UAAI,CAAC,KAAKwB,gBAAV,EAA4B;AAC1B,aAAKA,gBAAL,GAAwBI,GAAG,CAACC,SAA5B;AACD;;AAED,UAAI,KAAKL,gBAAL,KAA0BI,GAAG,CAACC,SAAlC,EAA6C;AAC3C,cAAM,IAAI7B,KAAJ,CAAU,+DAA+D,KAAKwB,gBAApE,GAAuF,OAAvF,GAAiGI,GAAG,CAACC,SAArG,GAAiH,GAA3H,CAAN;AACD;;AAED,aAAOD,GAAG,CAACb,EAAX;AACD;AAxBqC,GAAD,EAyBpC;AACD/B,IAAAA,GAAG,EAAE,SADJ;AAED3D,IAAAA,KAAK,EAAE,UAAUA;AACjB;AADO,MAELyG;AACF;AAHO,MAIL9C;AACF;AALO;AAOP;AACA;AACE,UAAI,CAAC3D,KAAL,EAAY;AACV,YAAI0G,SAAJ;;AAEA,YAAI,CAACD,MAAD,IAAW,CAAC9C,GAAhB,EAAqB;AACnB,gBAAM,IAAIgB,KAAJ,CAAU,mFAAV,CAAN;AACD;;AAED,YAAIgC,MAAM,GAAG,IAAIjF,YAAY,CAACQ,OAAjB,CAAyBuE,MAAM,CAACD,SAAhC,CAAb;;AAEA,YAAIC,MAAM,CAACf,EAAP,IAAa,CAAC,GAAG9E,QAAQ,CAACsB,OAAb,EAAsBwE,SAAS,GAAGD,MAAM,CAACf,EAAzC,EAA6C5C,IAA7C,CAAkD4D,SAAlD,EAA6D,OAA7D,MAA0E,CAA3F,EAA8F;AAC5FC,UAAAA,MAAM,CAACC,QAAP,GAAkBH,MAAM,CAACf,EAAzB;AACD,SAFD,MAEO,IAAIe,MAAM,CAACf,EAAX,EAAe;AACpBiB,UAAAA,MAAM,CAACjB,EAAP,GAAYe,MAAM,CAACf,EAAnB;AACD;;AAED,YAAImB,QAAQ,GAAG,IAAIlF,cAAc,CAACO,OAAnB,CAA2ByE,MAA3B,EAAmChD,GAAnC,CAAf;AACAkD,QAAAA,QAAQ,CAACC,eAAT,GAA2B,KAAKX,gBAAhC;AACA,eAAOU,QAAP;AACD;;AAED,UAAI7G,KAAK,YAAY2B,cAAc,CAACO,OAApC,EAA6C;AAC3C,YAAI,KAAKiE,gBAAT,EAA2B;AACzB,cAAInG,KAAK,CAAC8G,eAAV,EAA2B;AACzB,gBAAI,KAAKX,gBAAL,KAA0BnG,KAAK,CAAC8G,eAApC,EAAqD;AACnD,oBAAM,IAAInC,KAAJ,CAAU,8BAA8B3E,KAAK,CAAC8G,eAApC,GAAsD,UAAtD,GAAmE,KAAKX,gBAAxE,GAA2F,iBAArG,CAAN;AACD;AACF,WAJD,MAIO;AACLnG,YAAAA,KAAK,CAAC8G,eAAN,GAAwB,KAAKX,gBAA7B;AACD;AACF;;AAED,eAAOnG,KAAP;AACD,OAZD,MAYO;AACL,cAAM,IAAI2E,KAAJ,CAAU,oDAAV,CAAN;AACD;AACF;AA9CA,GAzBoC,EAwEpC;AACDhB,IAAAA,GAAG,EAAE,WADJ;AAED3D,IAAAA,KAAK,EAAE,UAAUyE;AACjB;AADO;AAGP;AACA;AACE,UAAI,CAACA,QAAL,EAAe;AACb,eAAO,IAAP;AACD,OAFD,MAEO,IAAIA,QAAQ,YAAYlE,OAAxB,EAAiC;AACtC,cAAM,IAAIoE,KAAJ,CAAU,iDAAV,CAAN;AACD,OAFM,MAEA,IAAIF,QAAQ,YAAYjE,KAApB,IAA6BiE,QAAQ,CAACV,MAAT,YAA2BpC,cAAc,CAACO,OAA3E,EAAoF;AACzF,eAAO,IAAP;AACD,OAFM,MAEA,IAAIuC,QAAQ,YAAYvE,UAAxB,EAAoC;AACzC,YAAI6G,SAAJ,EAAeC,SAAf,EAA0BC,SAA1B,EAAqCC,SAArC,EAAgDC,SAAhD,EAA2DC,SAA3D;;AAEA,YAAI3C,QAAQ,CAAC0B,gBAAT,IAA6B1B,QAAQ,CAAC0B,gBAAT,KAA8B,KAAKA,gBAApE,EAAsF;AACpF,gBAAM,IAAIxB,KAAJ,CAAU,qCAAqCF,QAAQ,CAAC0B,gBAA9C,GAAiE,QAAjE,IAA6E,KAAKA,gBAAL,IAAyB,MAAtG,IAAgH,iBAA1H,CAAN;AACD;;AAED,YAAIkB,MAAM,GAAG,CAAC,GAAGhG,OAAO,CAACa,OAAZ,EAAqB6E,SAAS,GAAGtC,QAAQ,CAAC2B,cAA1C,EAA0DtD,IAA1D,CAA+DiE,SAA/D,EAA0E,EAA1E,CAAb;AACA,SAAC,GAAGlG,QAAQ,CAACqB,OAAb,EAAsB8E,SAAS,GAAG,KAAKV,iBAAvC,EAA0DxD,IAA1D,CAA+DkE,SAA/D,EAA0E,UAAUM,CAAV,EAAa;AACrF,cAAI7B,KAAK,GAAG,CAAC,GAAG7E,QAAQ,CAACsB,OAAb,EAAsBmF,MAAtB,EAA8BvE,IAA9B,CAAmCuE,MAAnC,EAA2CC,CAA3C,CAAZ;;AAEA,cAAI7B,KAAK,GAAG,CAAC,CAAb,EAAgB;AACd,aAAC,GAAG9E,OAAO,CAACuB,OAAZ,EAAqBmF,MAArB,EAA6BvE,IAA7B,CAAkCuE,MAAlC,EAA0C5B,KAA1C,EAAiD,CAAjD;AACD;AACF,SAND;AAOA,SAAC,GAAG5E,QAAQ,CAACqB,OAAb,EAAsB+E,SAAS,GAAG,KAAKb,cAAvC,EAAuDtD,IAAvD,CAA4DmE,SAA5D,EAAuE,UAAUK,CAAV,EAAa;AAClF,cAAI7B,KAAK,GAAG,CAAC,GAAG7E,QAAQ,CAACsB,OAAb,EAAsBmF,MAAtB,EAA8BvE,IAA9B,CAAmCuE,MAAnC,EAA2CC,CAA3C,CAAZ;;AAEA,cAAI7B,KAAK,GAAG,CAAZ,EAAe;AACb4B,YAAAA,MAAM,CAACjC,IAAP,CAAYkC,CAAZ;AACD;AACF,SAND;AAOA,YAAIC,SAAS,GAAG,CAAC,GAAGlG,OAAO,CAACa,OAAZ,EAAqBgF,SAAS,GAAGzC,QAAQ,CAAC6B,iBAA1C,EAA6DxD,IAA7D,CAAkEoE,SAAlE,EAA6E,EAA7E,CAAhB;AACA,SAAC,GAAGrG,QAAQ,CAACqB,OAAb,EAAsBiF,SAAS,GAAG,KAAKf,cAAvC,EAAuDtD,IAAvD,CAA4DqE,SAA5D,EAAuE,UAAUG,CAAV,EAAa;AAClF,cAAI7B,KAAK,GAAG,CAAC,GAAG7E,QAAQ,CAACsB,OAAb,EAAsBqF,SAAtB,EAAiCzE,IAAjC,CAAsCyE,SAAtC,EAAiDD,CAAjD,CAAZ;;AAEA,cAAI7B,KAAK,GAAG,CAAC,CAAb,EAAgB;AACd,aAAC,GAAG9E,OAAO,CAACuB,OAAZ,EAAqBqF,SAArB,EAAgCzE,IAAhC,CAAqCyE,SAArC,EAAgD9B,KAAhD,EAAuD,CAAvD;AACD;AACF,SAND;AAOA,SAAC,GAAG5E,QAAQ,CAACqB,OAAb,EAAsBkF,SAAS,GAAG,KAAKd,iBAAvC,EAA0DxD,IAA1D,CAA+DsE,SAA/D,EAA0E,UAAUE,CAAV,EAAa;AACrF,cAAI7B,KAAK,GAAG,CAAC,GAAG7E,QAAQ,CAACsB,OAAb,EAAsBqF,SAAtB,EAAiCzE,IAAjC,CAAsCyE,SAAtC,EAAiDD,CAAjD,CAAZ;;AAEA,cAAI7B,KAAK,GAAG,CAAZ,EAAe;AACb8B,YAAAA,SAAS,CAACnC,IAAV,CAAekC,CAAf;AACD;AACF,SAND;AAOA,YAAIE,WAAW,GAAG,IAAItH,UAAJ,CAAemH,MAAf,EAAuBE,SAAvB,CAAlB;AACAC,QAAAA,WAAW,CAACrB,gBAAZ,GAA+B,KAAKA,gBAApC;AACA,eAAOqB,WAAP;AACD;;AAED,YAAM,IAAI7C,KAAJ,CAAU,+CAAV,CAAN;AACD;AAxDA,GAxEoC,EAiIpC;AACDhB,IAAAA,GAAG,EAAE,QADJ;AAED3D,IAAAA,KAAK,EAAE;AACP;AACA;AACE,UAAIyH,MAAM,GAAG,IAAb;;AAEA,UAAIC,WAAW,GAAG,UAAUhC,EAAV,EAAc;AAC9B,eAAO;AACLiC,UAAAA,MAAM,EAAE,SADH;AAELnB,UAAAA,SAAS,EAAEiB,MAAM,CAACtB,gBAFb;AAGLyB,UAAAA,QAAQ,EAAElC;AAHL,SAAP;AAKD,OAND;;AAQA,UAAIM,IAAI,GAAG,IAAX;AACA,UAAIC,OAAO,GAAG,IAAd;AACA,UAAI4B,QAAQ,GAAG,IAAf;;AAEA,UAAI,KAAKzB,cAAL,CAAoB1C,MAApB,GAA6B,CAAjC,EAAoC;AAClC,YAAIoE,UAAJ;;AAEAD,QAAAA,QAAQ,GAAG,CAAC,GAAGnH,IAAI,CAACwB,OAAT,EAAkB4F,UAAU,GAAG,KAAK1B,cAApC,EAAoDtD,IAApD,CAAyDgF,UAAzD,EAAqEJ,WAArE,CAAX;AACA1B,QAAAA,IAAI,GAAG;AACL/C,UAAAA,IAAI,EAAE,aADD;AAELE,UAAAA,OAAO,EAAE0E;AAFJ,SAAP;AAID;;AAED,UAAI,KAAKvB,iBAAL,CAAuB5C,MAAvB,GAAgC,CAApC,EAAuC;AACrC,YAAIqE,UAAJ;;AAEAF,QAAAA,QAAQ,GAAG,CAAC,GAAGnH,IAAI,CAACwB,OAAT,EAAkB6F,UAAU,GAAG,KAAKzB,iBAApC,EAAuDxD,IAAvD,CAA4DiF,UAA5D,EAAwEL,WAAxE,CAAX;AACAzB,QAAAA,OAAO,GAAG;AACRhD,UAAAA,IAAI,EAAE,gBADE;AAERE,UAAAA,OAAO,EAAE0E;AAFD,SAAV;AAID;;AAED,UAAI7B,IAAI,IAAIC,OAAZ,EAAqB;AACnB,eAAO;AACLhD,UAAAA,IAAI,EAAE,OADD;AAELQ,UAAAA,GAAG,EAAE,CAACuC,IAAD,EAAOC,OAAP;AAFA,SAAP;AAID;;AAED,aAAOD,IAAI,IAAIC,OAAR,IAAmB,EAA1B;AACD;AA/CA,GAjIoC,CAAvC;AAkLA,SAAO/F,UAAP;AACD,CAjN6B,CAiN5BO,EAjN4B,CAA9B;;AAmNAV,OAAO,CAACG,UAAR,GAAqBA,UAArB","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\nvar _Object$defineProperty = require(\"@babel/runtime-corejs3/core-js-stable/object/define-property\");\n\nvar _Reflect$construct = require(\"@babel/runtime-corejs3/core-js-stable/reflect/construct\");\n\n_Object$defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.opFromJSON = opFromJSON;\nexports.RelationOp = exports.RemoveOp = exports.AddUniqueOp = exports.AddOp = exports.IncrementOp = exports.UnsetOp = exports.SetOp = exports.Op = void 0;\n\nvar _map = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/map\"));\n\nvar _splice = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/splice\"));\n\nvar _indexOf = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/index-of\"));\n\nvar _forEach = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/for-each\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/inherits\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/getPrototypeOf\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/defineProperty\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/createClass\"));\n\nvar _concat = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/concat\"));\n\nvar _isArray = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\"));\n\nvar _arrayContainsObject = _interopRequireDefault(require(\"./arrayContainsObject\"));\n\nvar _decode = _interopRequireDefault(require(\"./decode\"));\n\nvar _encode = _interopRequireDefault(require(\"./encode\"));\n\nvar _ParseObject = _interopRequireDefault(require(\"./ParseObject\"));\n\nvar _ParseRelation = _interopRequireDefault(require(\"./ParseRelation\"));\n\nvar _unique = _interopRequireDefault(require(\"./unique\"));\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function () {\n    var Super = (0, _getPrototypeOf2.default)(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = (0, _getPrototypeOf2.default)(this).constructor;\n      result = _Reflect$construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return (0, _possibleConstructorReturn2.default)(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !_Reflect$construct) return false;\n  if (_Reflect$construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(_Reflect$construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction opFromJSON(json\n/*: { [key: string]: any }*/\n)\n/*: ?Op*/\n{\n  if (!json || !json.__op) {\n    return null;\n  }\n\n  switch (json.__op) {\n    case 'Delete':\n      return new UnsetOp();\n\n    case 'Increment':\n      return new IncrementOp(json.amount);\n\n    case 'Add':\n      return new AddOp((0, _decode.default)(json.objects));\n\n    case 'AddUnique':\n      return new AddUniqueOp((0, _decode.default)(json.objects));\n\n    case 'Remove':\n      return new RemoveOp((0, _decode.default)(json.objects));\n\n    case 'AddRelation':\n      {\n        var toAdd = (0, _decode.default)(json.objects);\n\n        if (!(0, _isArray.default)(toAdd)) {\n          return new RelationOp([], []);\n        }\n\n        return new RelationOp(toAdd, []);\n      }\n\n    case 'RemoveRelation':\n      {\n        var toRemove = (0, _decode.default)(json.objects);\n\n        if (!(0, _isArray.default)(toRemove)) {\n          return new RelationOp([], []);\n        }\n\n        return new RelationOp([], toRemove);\n      }\n\n    case 'Batch':\n      {\n        var _toAdd = [];\n        var _toRemove = [];\n\n        for (var i = 0; i < json.ops.length; i++) {\n          if (json.ops[i].__op === 'AddRelation') {\n            _toAdd = (0, _concat.default)(_toAdd).call(_toAdd, (0, _decode.default)(json.ops[i].objects));\n          } else if (json.ops[i].__op === 'RemoveRelation') {\n            _toRemove = (0, _concat.default)(_toRemove).call(_toRemove, (0, _decode.default)(json.ops[i].objects));\n          }\n        }\n\n        return new RelationOp(_toAdd, _toRemove);\n      }\n  }\n\n  return null;\n}\n\nvar Op = /*#__PURE__*/function () {\n  function Op() {\n    (0, _classCallCheck2.default)(this, Op);\n  }\n\n  (0, _createClass2.default)(Op, [{\n    key: \"applyTo\",\n    value: // Empty parent class\n    function ()\n    /*: mixed*/\n\n    /*: mixed*/\n    {}\n    /* eslint-disable-line no-unused-vars */\n\n  }, {\n    key: \"mergeWith\",\n    value: function ()\n    /*: Op*/\n\n    /*: ?Op*/\n    {}\n    /* eslint-disable-line no-unused-vars */\n\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: mixed*/\n    {}\n  }]);\n  return Op;\n}();\n\nexports.Op = Op;\n\nvar SetOp = /*#__PURE__*/function (_Op) {\n  (0, _inherits2.default)(SetOp, _Op);\n\n  var _super = _createSuper(SetOp);\n\n  function SetOp(value\n  /*: mixed*/\n  ) {\n    var _this;\n\n    (0, _classCallCheck2.default)(this, SetOp);\n    _this = _super.call(this);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"_value\", void 0);\n    _this._value = value;\n    return _this;\n  }\n\n  (0, _createClass2.default)(SetOp, [{\n    key: \"applyTo\",\n    value: function ()\n    /*: mixed*/\n    {\n      return this._value;\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function ()\n    /*: SetOp*/\n    {\n      return new SetOp(this._value);\n    }\n  }, {\n    key: \"toJSON\",\n    value: function (offline\n    /*:: ?: boolean*/\n    ) {\n      return (0, _encode.default)(this._value, false, true, undefined, offline);\n    }\n  }]);\n  return SetOp;\n}(Op);\n\nexports.SetOp = SetOp;\n\nvar UnsetOp = /*#__PURE__*/function (_Op2) {\n  (0, _inherits2.default)(UnsetOp, _Op2);\n\n  var _super2 = _createSuper(UnsetOp);\n\n  function UnsetOp() {\n    (0, _classCallCheck2.default)(this, UnsetOp);\n    return _super2.apply(this, arguments);\n  }\n\n  (0, _createClass2.default)(UnsetOp, [{\n    key: \"applyTo\",\n    value: function () {\n      return undefined;\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function ()\n    /*: UnsetOp*/\n    {\n      return new UnsetOp();\n    }\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: { __op: string }*/\n    {\n      return {\n        __op: 'Delete'\n      };\n    }\n  }]);\n  return UnsetOp;\n}(Op);\n\nexports.UnsetOp = UnsetOp;\n\nvar IncrementOp = /*#__PURE__*/function (_Op3) {\n  (0, _inherits2.default)(IncrementOp, _Op3);\n\n  var _super3 = _createSuper(IncrementOp);\n\n  function IncrementOp(amount\n  /*: number*/\n  ) {\n    var _this2;\n\n    (0, _classCallCheck2.default)(this, IncrementOp);\n    _this2 = _super3.call(this);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this2), \"_amount\", void 0);\n\n    if (typeof amount !== 'number') {\n      throw new TypeError('Increment Op must be initialized with a numeric amount.');\n    }\n\n    _this2._amount = amount;\n    return _this2;\n  }\n\n  (0, _createClass2.default)(IncrementOp, [{\n    key: \"applyTo\",\n    value: function (value\n    /*: ?mixed*/\n    )\n    /*: number*/\n    {\n      if (typeof value === 'undefined') {\n        return this._amount;\n      }\n\n      if (typeof value !== 'number') {\n        throw new TypeError('Cannot increment a non-numeric value.');\n      }\n\n      return this._amount + value;\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function (previous\n    /*: Op*/\n    )\n    /*: Op*/\n    {\n      if (!previous) {\n        return this;\n      }\n\n      if (previous instanceof SetOp) {\n        return new SetOp(this.applyTo(previous._value));\n      }\n\n      if (previous instanceof UnsetOp) {\n        return new SetOp(this._amount);\n      }\n\n      if (previous instanceof IncrementOp) {\n        return new IncrementOp(this.applyTo(previous._amount));\n      }\n\n      throw new Error('Cannot merge Increment Op with the previous Op');\n    }\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: { __op: string, amount: number }*/\n    {\n      return {\n        __op: 'Increment',\n        amount: this._amount\n      };\n    }\n  }]);\n  return IncrementOp;\n}(Op);\n\nexports.IncrementOp = IncrementOp;\n\nvar AddOp = /*#__PURE__*/function (_Op4) {\n  (0, _inherits2.default)(AddOp, _Op4);\n\n  var _super4 = _createSuper(AddOp);\n\n  function AddOp(value\n  /*: mixed | Array<mixed>*/\n  ) {\n    var _this3;\n\n    (0, _classCallCheck2.default)(this, AddOp);\n    _this3 = _super4.call(this);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this3), \"_value\", void 0);\n    _this3._value = (0, _isArray.default)(value) ? value : [value];\n    return _this3;\n  }\n\n  (0, _createClass2.default)(AddOp, [{\n    key: \"applyTo\",\n    value: function (value\n    /*: mixed*/\n    )\n    /*: Array<mixed>*/\n    {\n      if (value == null) {\n        return this._value;\n      }\n\n      if ((0, _isArray.default)(value)) {\n        return (0, _concat.default)(value).call(value, this._value);\n      }\n\n      throw new Error('Cannot add elements to a non-array value');\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function (previous\n    /*: Op*/\n    )\n    /*: Op*/\n    {\n      if (!previous) {\n        return this;\n      }\n\n      if (previous instanceof SetOp) {\n        return new SetOp(this.applyTo(previous._value));\n      }\n\n      if (previous instanceof UnsetOp) {\n        return new SetOp(this._value);\n      }\n\n      if (previous instanceof AddOp) {\n        return new AddOp(this.applyTo(previous._value));\n      }\n\n      throw new Error('Cannot merge Add Op with the previous Op');\n    }\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: { __op: string, objects: mixed }*/\n    {\n      return {\n        __op: 'Add',\n        objects: (0, _encode.default)(this._value, false, true)\n      };\n    }\n  }]);\n  return AddOp;\n}(Op);\n\nexports.AddOp = AddOp;\n\nvar AddUniqueOp = /*#__PURE__*/function (_Op5) {\n  (0, _inherits2.default)(AddUniqueOp, _Op5);\n\n  var _super5 = _createSuper(AddUniqueOp);\n\n  function AddUniqueOp(value\n  /*: mixed | Array<mixed>*/\n  ) {\n    var _this4;\n\n    (0, _classCallCheck2.default)(this, AddUniqueOp);\n    _this4 = _super5.call(this);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this4), \"_value\", void 0);\n    _this4._value = (0, _unique.default)((0, _isArray.default)(value) ? value : [value]);\n    return _this4;\n  }\n\n  (0, _createClass2.default)(AddUniqueOp, [{\n    key: \"applyTo\",\n    value: function (value\n    /*: mixed | Array<mixed>*/\n    )\n    /*: Array<mixed>*/\n    {\n      if (value == null) {\n        return this._value || [];\n      }\n\n      if ((0, _isArray.default)(value)) {\n        var _context;\n\n        var toAdd = [];\n        (0, _forEach.default)(_context = this._value).call(_context, function (v) {\n          if (v instanceof _ParseObject.default) {\n            if (!(0, _arrayContainsObject.default)(value, v)) {\n              toAdd.push(v);\n            }\n          } else {\n            if ((0, _indexOf.default)(value).call(value, v) < 0) {\n              toAdd.push(v);\n            }\n          }\n        });\n        return (0, _concat.default)(value).call(value, toAdd);\n      }\n\n      throw new Error('Cannot add elements to a non-array value');\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function (previous\n    /*: Op*/\n    )\n    /*: Op*/\n    {\n      if (!previous) {\n        return this;\n      }\n\n      if (previous instanceof SetOp) {\n        return new SetOp(this.applyTo(previous._value));\n      }\n\n      if (previous instanceof UnsetOp) {\n        return new SetOp(this._value);\n      }\n\n      if (previous instanceof AddUniqueOp) {\n        return new AddUniqueOp(this.applyTo(previous._value));\n      }\n\n      throw new Error('Cannot merge AddUnique Op with the previous Op');\n    }\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: { __op: string, objects: mixed }*/\n    {\n      return {\n        __op: 'AddUnique',\n        objects: (0, _encode.default)(this._value, false, true)\n      };\n    }\n  }]);\n  return AddUniqueOp;\n}(Op);\n\nexports.AddUniqueOp = AddUniqueOp;\n\nvar RemoveOp = /*#__PURE__*/function (_Op6) {\n  (0, _inherits2.default)(RemoveOp, _Op6);\n\n  var _super6 = _createSuper(RemoveOp);\n\n  function RemoveOp(value\n  /*: mixed | Array<mixed>*/\n  ) {\n    var _this5;\n\n    (0, _classCallCheck2.default)(this, RemoveOp);\n    _this5 = _super6.call(this);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this5), \"_value\", void 0);\n    _this5._value = (0, _unique.default)((0, _isArray.default)(value) ? value : [value]);\n    return _this5;\n  }\n\n  (0, _createClass2.default)(RemoveOp, [{\n    key: \"applyTo\",\n    value: function (value\n    /*: mixed | Array<mixed>*/\n    )\n    /*: Array<mixed>*/\n    {\n      if (value == null) {\n        return [];\n      }\n\n      if ((0, _isArray.default)(value)) {\n        // var i = value.indexOf(this._value);\n        var removed = (0, _concat.default)(value).call(value, []);\n\n        for (var i = 0; i < this._value.length; i++) {\n          var index = (0, _indexOf.default)(removed).call(removed, this._value[i]);\n\n          while (index > -1) {\n            (0, _splice.default)(removed).call(removed, index, 1);\n            index = (0, _indexOf.default)(removed).call(removed, this._value[i]);\n          }\n\n          if (this._value[i] instanceof _ParseObject.default && this._value[i].id) {\n            for (var j = 0; j < removed.length; j++) {\n              if (removed[j] instanceof _ParseObject.default && this._value[i].id === removed[j].id) {\n                (0, _splice.default)(removed).call(removed, j, 1);\n                j--;\n              }\n            }\n          }\n        }\n\n        return removed;\n      }\n\n      throw new Error('Cannot remove elements from a non-array value');\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function (previous\n    /*: Op*/\n    )\n    /*: Op*/\n    {\n      if (!previous) {\n        return this;\n      }\n\n      if (previous instanceof SetOp) {\n        return new SetOp(this.applyTo(previous._value));\n      }\n\n      if (previous instanceof UnsetOp) {\n        return new UnsetOp();\n      }\n\n      if (previous instanceof RemoveOp) {\n        var _context2;\n\n        var uniques = (0, _concat.default)(_context2 = previous._value).call(_context2, []);\n\n        for (var i = 0; i < this._value.length; i++) {\n          if (this._value[i] instanceof _ParseObject.default) {\n            if (!(0, _arrayContainsObject.default)(uniques, this._value[i])) {\n              uniques.push(this._value[i]);\n            }\n          } else {\n            if ((0, _indexOf.default)(uniques).call(uniques, this._value[i]) < 0) {\n              uniques.push(this._value[i]);\n            }\n          }\n        }\n\n        return new RemoveOp(uniques);\n      }\n\n      throw new Error('Cannot merge Remove Op with the previous Op');\n    }\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: { __op: string, objects: mixed }*/\n    {\n      return {\n        __op: 'Remove',\n        objects: (0, _encode.default)(this._value, false, true)\n      };\n    }\n  }]);\n  return RemoveOp;\n}(Op);\n\nexports.RemoveOp = RemoveOp;\n\nvar RelationOp = /*#__PURE__*/function (_Op7) {\n  (0, _inherits2.default)(RelationOp, _Op7);\n\n  var _super7 = _createSuper(RelationOp);\n\n  function RelationOp(adds\n  /*: Array<ParseObject | string>*/\n  , removes\n  /*: Array<ParseObject | string>*/\n  ) {\n    var _this6;\n\n    (0, _classCallCheck2.default)(this, RelationOp);\n    _this6 = _super7.call(this);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this6), \"_targetClassName\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this6), \"relationsToAdd\", void 0);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this6), \"relationsToRemove\", void 0);\n    _this6._targetClassName = null;\n\n    if ((0, _isArray.default)(adds)) {\n      _this6.relationsToAdd = (0, _unique.default)((0, _map.default)(adds).call(adds, _this6._extractId, (0, _assertThisInitialized2.default)(_this6)));\n    }\n\n    if ((0, _isArray.default)(removes)) {\n      _this6.relationsToRemove = (0, _unique.default)((0, _map.default)(removes).call(removes, _this6._extractId, (0, _assertThisInitialized2.default)(_this6)));\n    }\n\n    return _this6;\n  }\n\n  (0, _createClass2.default)(RelationOp, [{\n    key: \"_extractId\",\n    value: function (obj\n    /*: string | ParseObject*/\n    )\n    /*: string*/\n    {\n      if (typeof obj === 'string') {\n        return obj;\n      }\n\n      if (!obj.id) {\n        throw new Error('You cannot add or remove an unsaved Parse Object from a relation');\n      }\n\n      if (!this._targetClassName) {\n        this._targetClassName = obj.className;\n      }\n\n      if (this._targetClassName !== obj.className) {\n        throw new Error('Tried to create a Relation with 2 different object types: ' + this._targetClassName + ' and ' + obj.className + '.');\n      }\n\n      return obj.id;\n    }\n  }, {\n    key: \"applyTo\",\n    value: function (value\n    /*: mixed*/\n    , object\n    /*:: ?: { className: string, id: ?string }*/\n    , key\n    /*:: ?: string*/\n    )\n    /*: ?ParseRelation*/\n    {\n      if (!value) {\n        var _context3;\n\n        if (!object || !key) {\n          throw new Error('Cannot apply a RelationOp without either a previous value, or an object and a key');\n        }\n\n        var parent = new _ParseObject.default(object.className);\n\n        if (object.id && (0, _indexOf.default)(_context3 = object.id).call(_context3, 'local') === 0) {\n          parent._localId = object.id;\n        } else if (object.id) {\n          parent.id = object.id;\n        }\n\n        var relation = new _ParseRelation.default(parent, key);\n        relation.targetClassName = this._targetClassName;\n        return relation;\n      }\n\n      if (value instanceof _ParseRelation.default) {\n        if (this._targetClassName) {\n          if (value.targetClassName) {\n            if (this._targetClassName !== value.targetClassName) {\n              throw new Error('Related object must be a ' + value.targetClassName + ', but a ' + this._targetClassName + ' was passed in.');\n            }\n          } else {\n            value.targetClassName = this._targetClassName;\n          }\n        }\n\n        return value;\n      } else {\n        throw new Error('Relation cannot be applied to a non-relation field');\n      }\n    }\n  }, {\n    key: \"mergeWith\",\n    value: function (previous\n    /*: Op*/\n    )\n    /*: Op*/\n    {\n      if (!previous) {\n        return this;\n      } else if (previous instanceof UnsetOp) {\n        throw new Error('You cannot modify a relation after deleting it.');\n      } else if (previous instanceof SetOp && previous._value instanceof _ParseRelation.default) {\n        return this;\n      } else if (previous instanceof RelationOp) {\n        var _context4, _context5, _context6, _context7, _context8, _context9;\n\n        if (previous._targetClassName && previous._targetClassName !== this._targetClassName) {\n          throw new Error('Related object must be of class ' + previous._targetClassName + ', but ' + (this._targetClassName || 'null') + ' was passed in.');\n        }\n\n        var newAdd = (0, _concat.default)(_context4 = previous.relationsToAdd).call(_context4, []);\n        (0, _forEach.default)(_context5 = this.relationsToRemove).call(_context5, function (r) {\n          var index = (0, _indexOf.default)(newAdd).call(newAdd, r);\n\n          if (index > -1) {\n            (0, _splice.default)(newAdd).call(newAdd, index, 1);\n          }\n        });\n        (0, _forEach.default)(_context6 = this.relationsToAdd).call(_context6, function (r) {\n          var index = (0, _indexOf.default)(newAdd).call(newAdd, r);\n\n          if (index < 0) {\n            newAdd.push(r);\n          }\n        });\n        var newRemove = (0, _concat.default)(_context7 = previous.relationsToRemove).call(_context7, []);\n        (0, _forEach.default)(_context8 = this.relationsToAdd).call(_context8, function (r) {\n          var index = (0, _indexOf.default)(newRemove).call(newRemove, r);\n\n          if (index > -1) {\n            (0, _splice.default)(newRemove).call(newRemove, index, 1);\n          }\n        });\n        (0, _forEach.default)(_context9 = this.relationsToRemove).call(_context9, function (r) {\n          var index = (0, _indexOf.default)(newRemove).call(newRemove, r);\n\n          if (index < 0) {\n            newRemove.push(r);\n          }\n        });\n        var newRelation = new RelationOp(newAdd, newRemove);\n        newRelation._targetClassName = this._targetClassName;\n        return newRelation;\n      }\n\n      throw new Error('Cannot merge Relation Op with the previous Op');\n    }\n  }, {\n    key: \"toJSON\",\n    value: function ()\n    /*: { __op?: string, objects?: mixed, ops?: mixed }*/\n    {\n      var _this7 = this;\n\n      var idToPointer = function (id) {\n        return {\n          __type: 'Pointer',\n          className: _this7._targetClassName,\n          objectId: id\n        };\n      };\n\n      var adds = null;\n      var removes = null;\n      var pointers = null;\n\n      if (this.relationsToAdd.length > 0) {\n        var _context10;\n\n        pointers = (0, _map.default)(_context10 = this.relationsToAdd).call(_context10, idToPointer);\n        adds = {\n          __op: 'AddRelation',\n          objects: pointers\n        };\n      }\n\n      if (this.relationsToRemove.length > 0) {\n        var _context11;\n\n        pointers = (0, _map.default)(_context11 = this.relationsToRemove).call(_context11, idToPointer);\n        removes = {\n          __op: 'RemoveRelation',\n          objects: pointers\n        };\n      }\n\n      if (adds && removes) {\n        return {\n          __op: 'Batch',\n          ops: [adds, removes]\n        };\n      }\n\n      return adds || removes || {};\n    }\n  }]);\n  return RelationOp;\n}(Op);\n\nexports.RelationOp = RelationOp;"]},"metadata":{},"sourceType":"script"}